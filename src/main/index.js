function createBoard(t){const e=document.querySelector("table"),c=Array(t).fill(1).map((t,e)=>t+e);c.forEach(a=>{const r=document.createElement("tr");e.append(r),c.forEach(t=>{var e=document.createElement("td");e.setAttribute("id",a.toString()+t.toString()),e.classList.add((a+t)%2?"blackBoard":"whiteBoard"),r.append(e)})})}
function applyFullscreen(){var e=document.querySelector("#full");const l=document.querySelector("#fullscreen");null!=e&&e.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen&&(null!==l&&void 0!==l&&l.setAttribute("src","../imgs/fullscreen.png"),document.exitFullscreen()):(null!==l&&void 0!==l&&l.setAttribute("src","../imgs/exit-fullscreen.png"),document.documentElement.requestFullscreen())})}
class Game{constructor(e){this.bs=e,this.board=[p("w","k",8,5),p("w","q",8,4),p("w","b",8,3),p("w","b",8,6),p("w","n",5,2),p("w","n",8,7),p("w","r",4,4),p("w","r",8,8),p("b","k",1,5),p("b","q",1,4),p("b","b",1,3),p("b","b",1,6),p("b","n",1,2),p("b","n",1,7),p("b","r",1,1),p("b","r",1,8)],createBoard(e);for(let e=1;e<=8;e++)this.board.push(p("w","p",7,e)),this.board.push(p("b","p",2,e));this.board[16]=new PieceStruct(Side.White,Piece.Pawn,{vert:5,hori:5})}showPieces(e=[]){showPiecesFN(this.board,this.bs,e)}async willMoveListener(i){let t=-1;function a(e){return()=>{t=e}}return this.board.forEach((e,t)=>{e.side===i&&(null!=(e=document.getElementById(byString(e.location)))&&e.classList.add(["choosableWhite","choosableBlack"][Array.from(e.id).map(e=>parseInt(e)).reduce((e,t)=>e+t,0)%2]),null!=e)&&e.addEventListener("click",a(t))}),await waitUntil(()=>-1!==t),this.board.forEach((e,t)=>{e=document.getElementById(byString(e.location));null!=e&&e.classList.remove("choosableBlack","choosableWhite"),null!=e&&e.removeEventListener("click",a(t))}),t}movableLocationsOf(e){var e=this.board[e];let t=Object.values(ml)[e.piece];return null!=(e=(t="wPawn"===t.name?e.side===Side.White?ml.wPawn:ml.bPawn:t)(e,this.board,this.bs))?e:[]}}
const foo=[];function getPieceWhoseLocationIs(o,n,e){const t={vert:o,hori:n};let r=-1;return e.forEach((o,n)=>{byString(o.location)===byString(t)&&(r=n)}),-1===r?new PieceStruct(Side.null,Piece.null,{vert:0,hori:0}):e[r]}function king(o,n,e){return foo}function queen(o,n,e){return foo}function bishop(o,n,e){return foo}function night(o,n,e){return foo}function rook(t,r,n){const i=[];function e(o,n){var e=getPieceWhoseLocationIs(o,n,r);if(e.side!==Side.null&&e.piece!==Piece.null)return e.side!==t.side&&i.push({vert:o,hori:n}),1;i.push({vert:o,hori:n})}for(let o=t.vert+1;o<=n&&!e(o,t.hori);o++);for(let o=t.vert-1;1<=o&&!e(o,t.hori);o--);for(let o=t.hori+1;o<=n&&!e(t.vert,o);o++);for(let o=t.hori-1;1<=o&&!e(t.vert,o);o--);return i}function wPawn(o,n,e){return foo}function bPawn(o,n,e){foo}const ml={king:king,queen:queen,bishop:bishop,night:night,rook:rook,wPawn:wPawn,bPawn:bPawn};
class PieceStruct{constructor(t,i,e){this.side=t,this.piece=i,this.location=e}get vert(){return this.location.vert}get hori(){return this.location.hori}}
function p(e,r,n,t){return new PieceStruct(parseInt(Object.keys(Side)[Array.from("wb").indexOf(e)]),parseInt(Object.keys(Piece)[Array.from("kqbnrp").indexOf(r)]),{vert:n,hori:t})}
function showPiecesFN(e,t,n=[]){for(var i of e){var c=document.getElementById(byString(i.location));c.classList.remove("whitePiece","blackPiece"),c.classList.add(["whitePiece","blackPiece"][i.side]),c.textContent=["왕","여왕","비숍","말","룩","폰"][i.piece]}for(let e=11;e<=10*t+1;e+=10){var o=document.getElementById(e.toString());o.innerHTML||(o.innerHTML="&nbsp;")}for(var r of n){r=document.getElementById(byString(r));null!=r&&r.classList.remove("whiteBoard","blackBoard"),null!=r&&r.classList.add(["chosenWhite","chosenBlack"][Array.from(r.id).map(e=>parseInt(e)).reduce((e,t)=>e+t,0)%2])}}
var Piece,Side,Mode;function byString(e){return Object.values(e).join("")}!function(e){e[e.King=0]="King",e[e.Queen=1]="Queen",e[e.Bishop=2]="Bishop",e[e.Night=3]="Night",e[e.Rook=4]="Rook",e[e.Pawn=5]="Pawn",e[e.null=-1]="null"}(Piece=Piece||{}),function(e){e[e.White=0]="White",e[e.Black=1]="Black",e[e.null=-1]="null"}(Side=Side||{}),function(e){e[e.classic=0]="classic",e[e.customizable=1]="customizable",e[e.tenXten=2]="tenXten",e[e.null=-1]="null"}(Mode=Mode||{});
function checkURL(e){e=new URL(e).searchParams.get("mode");return"classic"===e?Mode.classic:"customizable"===e?Mode.customizable:"tenXten"===e?Mode.tenXten:Mode.null}
function waitUntil(e){return new Promise(n=>{const t=setInterval(()=>{e()&&(n(null),clearInterval(t))},100)})}
applyFullscreen();const body=document.querySelector("body"),o=document.querySelector("#o"),x=document.querySelector("#x"),whiteSide=document.querySelector("#whiteSide"),blackSide=document.querySelector("#blackSide");async function playGame(){for(var e=Side.White,o=new Game(8);;){o.showPieces([]),e===Side.White?null!==blackSide&&void 0!==blackSide&&blackSide.classList.add("opacityDown"):null!==whiteSide&&void 0!==whiteSide&&whiteSide.classList.add("opacityDown");var d=await o.willMoveListener(e),d=o.movableLocationsOf(d);o.showPieces(d)}}checkURL(window.location.href)===Mode.null?(null!==body&&void 0!==body&&body.classList.add("impossibleURL"),null!==o&&void 0!==o&&o.classList.add("hideEle")):(null!==body&&void 0!==body&&body.classList.add("possibleURL"),null!==x&&void 0!==x&&x.classList.add("hideEle"),playGame());